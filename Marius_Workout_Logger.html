<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Marius Workout Logger (Single File)</title>
  <meta name="theme-color" content="#0f172a"/>
  <style>
    :root { --bg:#0b1020; --card:#111936; --muted:#a8b3cf; --txt:#e6ecff; --acc:#4ade80; --danger:#f87171; }
    * { box-sizing: border-box; font-family: system-ui, -apple-system, "Segoe UI", Roboto, "Noto Sans", "Helvetica Neue", Arial; }
    body { margin:0; background:linear-gradient(180deg, #0b1020, #0b0f1a 60%); color:var(--txt); }
    header { position:sticky; top:0; z-index:5; backdrop-filter: blur(6px); background:rgba(11,16,32,.7); border-bottom:1px solid #1e293b; padding:12px 16px; display:flex; gap:12px; align-items:center; justify-content:space-between; }
    h1 { font-size:18px; margin:0; }
    main { padding:16px; max-width:900px; margin:0 auto; }
    .row { display:flex; gap:12px; flex-wrap:wrap; }
    .card { background:var(--card); border:1px solid #1f2a44; border-radius:16px; padding:14px; }
    .tab { padding:8px 12px; border-radius:999px; background:#0f172a; border:1px solid #1f2a44; color:var(--muted); cursor:pointer; }
    .tab.active { color:#fff; border-color:#334155; background:#111c3a; }
    select, input, button { width:100%; padding:10px 12px; border-radius:12px; border:1px solid #2b3a64; background:#0e1530; color:#e6ecff; }
    button.primary { background:linear-gradient(135deg,#1db954,#4ade80); border:none; color:#0b0f1a; font-weight:700; }
    button.danger { background:#3d0e16; border:1px solid #7f1d1d; color:#fecaca; }
    label { display:block; font-size:13px; color:var(--muted); margin:6px 0 4px; }
    .grid { display:grid; grid-template-columns: 1fr 1fr; gap:12px; }
    .exercise { border-top:1px dashed #263455; padding-top:12px; margin-top:12px; }
    .muted { color:var(--muted); font-size:13px; }
    .pill { display:inline-block; padding:3px 8px; border-radius:999px; background:#0e1530; border:1px solid #2b3a64; font-size:12px; color:#a8b3cf; }
    .footer { margin-top:48px; color:#93a1c8; font-size:12px; text-align:center; }
    .kpis { display:grid; grid-template-columns: repeat(3, 1fr); gap:10px; margin:12px 0; }
    .kpi { background:#0f1733; border:1px solid #27345b; padding:10px; border-radius:12px; text-align:center; }
    @media (max-width:640px){ .grid { grid-template-columns: 1fr; } }
  </style>
</head>
<body>
  <header>
    <h1>Workout Logger</h1>
    <div class="row" style="gap:8px">
      <button id="tab-workout" class="tab active">Log</button>
      <button id="tab-history" class="tab">History</button>
      <button id="tab-settings" class="tab">Settings</button>
    </div>
  </header>

  <main>
    <!-- LOG PAGE -->
    <section id="page-workout" class="card">
      <div class="grid">
        <div>
          <label for="workout">Workout Day</label>
          <select id="workout"></select>
        </div>
        <div>
          <label for="date">Date</label>
          <input id="date" type="date"/>
        </div>
      </div>

      <div class="kpis">
        <div class="kpi"><div class="muted">Sets logged</div><div id="kpi-sets">0</div></div>
        <div class="kpi"><div class="muted">Exercises done</div><div id="kpi-ex">0</div></div>
        <div class="kpi"><div class="muted">Est. tonnage (kg)</div><div id="kpi-ton">0</div></div>
      </div>

      <div id="exercise-list"></div>
      <div class="row" style="margin-top:12px;">
        <button id="save" class="primary">Save Session</button>
        <button id="clear" class="danger">Clear All Inputs</button>
      </div>
      <p class="muted" style="margin-top:8px">Suggestions appear after you’ve logged at least one prior session for that exact exercise & day (A/B kept separate).</p>
    </section>

    <!-- HISTORY PAGE -->
    <section id="page-history" class="card" style="display:none">
      <div class="grid">
        <div><label for="h-workout">Workout</label><select id="h-workout"></select></div>
        <div><label for="h-exercise">Exercise</label><select id="h-exercise"></select></div>
      </div>
      <div id="history"></div>
    </section>

    <!-- SETTINGS PAGE -->
    <section id="page-settings" class="card" style="display:none">
      <h2>Settings & Data</h2>
      <div class="row">
        <button class="ghost" id="export">Export Data (JSON)</button>
        <input id="importFile" type="file" accept=".json" />
        <button class="ghost" id="import">Import</button>
      </div>
      <p class="muted">Data is saved locally (in your browser). Export regularly for backup.</p>
      <hr style="border-color:#263455; border-style:dashed;">
      <h3>Suggestion logic</h3>
      <p class="muted">If you hit the top rep range on all sets for two sessions in a row: try +2.5–5% load. Otherwise, add +1 rep on the first set that’s below the top range.</p>
    </section>

    <div class="footer">v1.1 — Single-file build • A/B days logged separately • Works offline</div>
  </main>

  <script>
  // ----------- DATA: YOUR SIX WORKOUTS -----------
  const WORKOUTS = {
    "Push A": [
      "Incline DB press (15–30°) — 4×6–10",
      "Flat machine chest press — 4×8–12",
      "High-to-low cable fly — 3×10–15",
      "Machine shoulder press (neutral grip) — 3×8–12",
      "Cable lateral raise — 4×12–20",
      "Cable pressdown (neutral/V-bar) — 3–4×10–15",
      "Overhead cable triceps (rope) — 2–3×12–15"
    ],
    "Push B": [
      "Machine shoulder press or landmine press — 4×8–12",
      "DB/cable laterals — 4×12–20",
      "Rear-delt cable fly — 3×15–25",
      "Incline DB press — 2–3×8–12",
      "Dip machine or decline machine — 2×10–15",
      "Cable pressdown — 3×10–15",
      "Cross-body cable extensions — 2×12–15"
    ],
    "Legs A": [
      "Leg press — 4×10–15",
      "Hack or belt squat — 3–4×8–12",
      "Bulgarian split squat — 3×10–12/side",
      "Leg extension — 3×12–15",
      "Leg-press calf raises — 4×8–12",
      "45° back extension — 2–3×12"
    ],
    "Legs B": [
      "DB RDL — 3×6–10",
      "Hip thrust — 4×8–12",
      "Seated ham curl — 4×10–15",
      "Cable/banded hip abduction — 3×12–20",
      "Leg press (easy) — 2–3×12–15",
      "Seated calf raise — 4×10–15"
    ],
    "Pull A": [
      "Chest-supported row (machine) — 4×8–12",
      "Seated cable row (neutral) — 3×8–12",
      "Lat pulldown (medium neutral) — 3–4×8–12",
      "Reverse pec-deck — 3×12–20",
      "Incline DB curl — 3×8–12",
      "Cable curl (EZ/straight) — 2×12–15"
    ],
    "Pull B": [
      "Neutral-grip pull-ups/assisted — 4×6–10",
      "One-arm high-cable lat row — 3×10–15/side",
      "Straight-arm pulldown — 3×12–15",
      "Chest-supported T-bar — 3×10–12",
      "Rear-delt cable Y-raise — 3×15–20",
      "Preacher curl (machine) — 3×8–12",
      "Hammer curls — 3×10–12",
      "Scap pull-ups — 2×8–12"
    ]
  };

  // ----------- STORAGE -----------
  const KEY="marius_logger_v1";
  function loadDB(){ try { return JSON.parse(localStorage.getItem(KEY)) || {logs:[]}; } catch(e){ return {logs:[]}; } }
  function saveDB(db){ localStorage.setItem(KEY, JSON.stringify(db)); }

  // ----------- NAV / TABS -----------
  const pages={workout:document.getElementById('page-workout'),history:document.getElementById('page-history'),settings:document.getElementById('page-settings')};
  const tabs={workout:document.getElementById('tab-workout'),history:document.getElementById('tab-history'),settings:document.getElementById('tab-settings')};
  function setTab(name){ for(const k of Object.keys(pages)){ pages[k].style.display=(k===name)?'block':'none'; tabs[k].classList.toggle('active',k===name); } }
  tabs.workout.onclick=()=>setTab('workout'); tabs.history.onclick=()=>setTab('history'); tabs.settings.onclick=()=>setTab('settings');

  // ----------- ELEMENTS -----------
  const selWorkout=document.getElementById('workout');
  const selHistWorkout=document.getElementById('h-workout');
  const selHistExercise=document.getElementById('h-exercise');
  const dateInput=document.getElementById('date');
  const list=document.getElementById('exercise-list');
  const kpiSets=document.getElementById('kpi-sets');
  const kpiEx=document.getElementById('kpi-ex');
  const kpiTon=document.getElementById('kpi-ton');

  // ----------- INIT (fixed: set default ONCE, don't override in render) -----------
  function init(){
    const ws = Object.keys(WORKOUTS);

    // Populate selects
    selWorkout.innerHTML=''; selHistWorkout.innerHTML='';
    ws.forEach(w=>{
      let a=document.createElement('option'); a.value=w; a.textContent=w; selWorkout.appendChild(a);
      let b=document.createElement('option'); b.value=w; b.textContent=w; selHistWorkout.appendChild(b);
    });

    // Default once
    selWorkout.value = ws[0];
    dateInput.valueAsDate = new Date();

    renderExercises();
    renderHistorySelectors();
    updateKPIs();

    // listen for changes
    selWorkout.addEventListener('change', ()=>{ renderExercises(); updateKPIs(); });
    dateInput.addEventListener('change', updateKPIs);
  }

  // ----------- RENDER EXERCISES (fixed: trust current selection) -----------
  function renderExercises(){
    list.innerHTML='';
    const w = selWorkout.value || Object.keys(WORKOUTS)[0];
    const exs = WORKOUTS[w] || [];

    exs.forEach((ex, idx)=>{
      const setsMatch = ex.match(/(\d+)×(\d+)[–-](\d+)/);
      const defSets = setsMatch ? parseInt(setsMatch[1]) : 3;
      const repMin  = setsMatch ? parseInt(setsMatch[2]) : 8;
      const repMax  = setsMatch ? parseInt(setsMatch[3]) : 12;
      const last = lastSession(w, ex);

      const div = document.createElement('div');
      div.className='exercise';
      div.innerHTML = `
        <div class="row" style="align-items:center; justify-content:space-between">
          <div><strong>${ex}</strong> <span class="muted">(${w})</span></div>
          <span class="pill">Last: ${ last ? formatSummary(last) : '—' }</span>
        </div>
        <div class="grid" style="margin-top:8px;">
          <div>
            <label>Sets × Reps</label>
            <input id="sr-${idx}" placeholder="${defSets} sets in ${repMin}–${repMax} reps" />
          </div>
          <div>
            <label>Load (kg)</label>
            <input id="ld-${idx}" placeholder="e.g. 30, 30, 27.5" />
          </div>
        </div>
        <div class="grid">
          <div>
            <label>RIR (per set)</label>
            <input id="rr-${idx}" placeholder="e.g. 2, 1, 1" />
          </div>
          <div>
            <label>Suggestion</label>
            <div class="muted" id="sg-${idx}">${suggestionText(w, ex, repMin, repMax)}</div>
          </div>
        </div>
      `;
      list.appendChild(div);
    });
  }

  // ----------- HELPERS -----------
  function formatSummary(entry){
    const sets = entry.sets.map(s=>s.reps).join('/');
    const wt   = entry.sets.map(s=>s.weight).join('/');
    return `${entry.date} • ${wt} kg • ${sets} reps`;
  }
  function lastSession(workout,exercise){
    const db=loadDB(); const f=db.logs.filter(l=>l.workout===workout && l.exercise===exercise);
    return f.sort((a,b)=>b.ts-a.ts)[0];
  }
  function priorTwo(workout, exercise){
    const db=loadDB(); const f=db.logs.filter(l=>l.workout===workout && l.exercise===exercise).sort((a,b)=>b.ts-a.ts);
    return f.slice(0,2);
  }
  function suggestionText(workout, exercise, repMin, repMax){
    const prev = priorTwo(workout, exercise);
    if(!prev.length) return "Aim mid-range. Log to unlock suggestions.";
    const last = prev[0];
    const allTop = last.sets.every(s=>s.reps>=repMax);
    const twoTop = (prev.length===2) && prev[1].sets.every(s=>s.reps>=repMax);
    if(allTop && twoTop) return "✅ Top range twice — try +2.5–5% load.";
    const firstBelow = last.sets.findIndex(s=>s.reps<repMax);
    if(firstBelow>=0) return `Add +1 rep on set ${firstBelow+1} (target ${repMax}).`;
    return "Hold load; focus on slower eccentrics or tighter form.";
  }

  // ----------- SAVE SESSION -----------
  document.getElementById('save').onclick=()=>{
    const w = selWorkout.value;
    const exs = WORKOUTS[w];
    const date = document.getElementById('date').value || new Date().toISOString().slice(0,10);
    const entries=[];
    exs.forEach((ex, idx)=>{
      const sr=document.getElementById('sr-'+idx).value.trim();
      const ld=document.getElementById('ld-'+idx).value.trim();
      const rr=document.getElementById('rr-'+idx).value.trim();
      if(!sr && !ld && !rr) return;
      const sets = parseSets(sr, ld, rr, ex);
      entries.push({ workout:w, exercise:ex, date, sets, ts:Date.now() });
    });
    if(!entries.length){ alert("No inputs to save."); return; }
    const db=loadDB(); db.logs.push(...entries); saveDB(db);
    alert("Session saved.");
    renderExercises(); updateKPIs(); renderHistorySelectors();
  };

  function parseSets(sr, ld, rr, ex){
    const setsInName = ex.match(/(\d+)×(\d+)[–-](\d+)/);
    const defaultN = setsInName ? parseInt(setsInName[1]) : 3;
    const repsList = (sr||'').split(',').map(s=>parseInt(s.trim())).filter(n=>!isNaN(n));
    const loadsList= (ld||'').split(',').map(s=>parseFloat(s.trim())).filter(n=>!isNaN(n));
    const rirList  = (rr||'').split(',').map(s=>parseFloat(s.trim())).filter(n=>!isNaN(n));
    const n = Math.max(defaultN, repsList.length, loadsList.length, rirList.length);
    const sets=[];
    for(let i=0;i<n;i++){
      const reps = repsList[i] ?? repsList[repsList.length-1] ?? (setsInName ? (setsInName[2]|0) : 10);
      const weight = loadsList[i] ?? loadsList[0] ?? 0;
      const rir = rirList[i] ?? 2;
      sets.push({ reps, weight, rir });
    }
    return sets;
  }

  // ----------- KPIs -----------
  function updateKPIs(){
    const db=loadDB();
    const today = document.getElementById('date').value || new Date().toISOString().slice(0,10);
    const w = selWorkout.value;
    const logs = db.logs.filter(l=>l.date===today && l.workout===w);
    const setCount = logs.reduce((a,l)=>a+l.sets.length,0);
    const exDone = logs.length;
    const ton = logs.reduce((a,l)=>a+l.sets.reduce((t,s)=>t + s.weight*s.reps,0),0);
    kpiSets.textContent=setCount; kpiEx.textContent=exDone; kpiTon.textContent=Math.round(ton);
  }

  // ----------- HISTORY -----------
  function renderHistorySelectors(){
    const w = selHistWorkout.value || Object.keys(WORKOUTS)[0];
    selHistWorkout.value = w;
    selHistExercise.innerHTML='';
    (WORKOUTS[w]||[]).forEach(ex=>{
      const o=document.createElement('option'); o.value=ex; o.textContent=ex; selHistExercise.appendChild(o);
    });
    renderHistory();
  }
  selHistWorkout.onchange=renderHistorySelectors;
  selHistExercise.onchange=renderHistory;

  function renderHistory(){
    const w = selHistWorkout.value;
    const ex = selHistExercise.value;
    const db=loadDB();
    const logs = db.logs.filter(l=>l.workout===w && l.exercise===ex).sort((a,b)=>b.ts-a.ts);
    const container=document.getElementById('history');
    container.innerHTML='';
    if(!logs.length){ container.innerHTML='<p class="muted">No history yet for this selection.</p>'; return; }
    logs.slice(0,10).forEach(l=>{
      const ton = l.sets.reduce((t,s)=>t + s.weight*s.reps,0);
      const div=document.createElement('div');
      div.className='exercise';
      div.innerHTML=`
        <div style="display:flex; justify-content:space-between; align-items:center;">
          <strong>${l.date}</strong>
          <span class="pill">Tonnage: ${Math.round(ton)} kg</span>
        </div>
        <div class="muted">Sets: ${l.sets.map(s=> s.weight+'kg × '+s.reps+' @RIR'+s.rir).join(' | ')}</div>
      `;
      container.appendChild(div);
    });
  }

  // ----------- MISC -----------
  document.getElementById('clear').onclick=()=>{ Array.from(list.querySelectorAll('input')).forEach(i=>i.value=''); };
  document.getElementById('export').onclick=()=>{
    const blob=new Blob([JSON.stringify(loadDB(),null,2)],{type:'application/json'});
    const url=URL.createObjectURL(blob); const a=document.createElement('a');
    a.href=url; a.download='marius_workout_data.json'; a.click(); setTimeout(()=>URL.revokeObjectURL(url),1000);
  };
  document.getElementById('import').onclick=()=>{
    const f=document.getElementById('importFile').files[0]; if(!f) return;
    const r=new FileReader();
    r.onload=()=>{
      try{
        const d=JSON.parse(r.result); if(!d.logs) throw 0;
        saveDB(d); alert("Import complete."); renderExercises(); renderHistorySelectors(); updateKPIs();
      }catch(e){ alert("Import failed."); }
    };
    r.readAsText(f);
  };

  // boot
  init();
  </script>
</body>
</html>
